{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "SBA results",
  "description": "Schema for storing sliding block analysis results in JSON format.",
  "type": "object",
  "properties": {
    "schema_version": {
      "type": "string",
      "const": "1.0",
      "description": "Version of this schema"
    },
    "metadata": {
      "type": "object",
      "description": "Metadata about the source of the results",
      "properties": {
        "source_program": {
          "type": "string",
          "description": "Name of the source program (e.g., 'SLAMMER')"
        },
        "source_version": {
          "type": "string",
          "description": "Version of the source program (e.g., 'v1.2.3')"
        },
        "date_extracted": {
          "type": "string",
          "format": "date",
          "description": "Date when the data was extracted from source format"
        },
        "total_analyses": {
          "type": "integer",
          "minimum": 0,
          "description": "Total number of analyses in this dataset"
        },
        "description": {
          "type": "string",
          "description": "Optional description of the dataset"
        }
      },
      "required": [
        "source_program",
        "date_extracted"
      ],
      "additionalProperties": false
    },
    "analyses": {
      "type": "array",
      "description": "Array of analyses with their input parameters and results",
      "items": {
        "type": "object",
        "properties": {
          "analysis_id": {
            "type": "string",
            "description": "Unique identifier for this test case",
            "pattern": "^[a-zA-Z0-9_-]+$"
          },
          "ground_motion_parameters": {
            "type": "object",
            "description": "Parameters related to the earthquake record and scaling",
            "properties": {
              "earthquake": {
                "type": "string",
                "description": "Name or description of the earthquake event"
              },
              "record_station": {
                "type": "string",
                "description": "Recording station and direction (e.g., 'PET-090')"
              },
              "target_pga_g": {
                "type": "number",
                "minimum": 0,
                "description": "Target peak ground acceleration as ratio to g"
              },
              "ground_motion_file": {
                "type": "string",
                "description": "Corresponding CSV file in pySLAMMER sample_ground_motions directory"
              },
              "description": {
                "type": "string",
                "description": "Optional additional description"
              }
            },
            "required": [
              "earthquake",
              "record_station",
              "target_pga_g",
              "ground_motion_file"
            ],
            "additionalProperties": false
          },
          "analysis": {
            "type": "object",
            "description": "Analysis method and configuration",
            "properties": {
              "method": {
                "type": "string",
                "enum": [
                  "rigid",
                  "decoupled",
                  "coupled"
                ],
                "description": "Type of sliding block analysis method"
              },
              "mode": {
                "type": "string",
                "enum": [
                  "linear_elastic",
                  "equivalent_linear"
                ],
                "description": "Analysis mode for decoupled/coupled methods"
              }
            },
            "required": [
              "method"
            ],
            "additionalProperties": false,
            "if": {
              "properties": {
                "method": {
                  "enum": [
                    "decoupled",
                    "coupled"
                  ]
                }
              }
            },
            "then": {
              "required": [
                "mode"
              ]
            }
          },
          "site_parameters": {
            "type": "object",
            "description": "Site-specific parameters for the analysis",
            "properties": {
              "ky_g": {
                "type": "number",
                "minimum": 0,
                "description": "Yield coefficient (ratio of yield acceleration to gravity)"
              },
              "height_m": {
                "type": "number",
                "minimum": 0,
                "description": "Height of the soil column in meters (decoupled/coupled only)"
              },
              "vs_slope_mps": {
                "type": "number",
                "minimum": 0,
                "description": "Shear wave velocity at slope surface in m/s (decoupled/coupled only)"
              },
              "vs_base_mps": {
                "type": "number",
                "minimum": 0,
                "description": "Shear wave velocity at base in m/s (decoupled/coupled only)"
              },
              "damping_ratio": {
                "type": "number",
                "minimum": -0.5,
                "maximum": 1,
                "description": "Initial damping ratio (decoupled/coupled only)"
              },
              "reference_strain": {
                "type": "number",
                "minimum": 0,
                "description": "Reference strain for equivalent linear analysis"
              }
            },
            "required": [
              "ky_g"
            ],
            "additionalProperties": false
          },
          "results": {
            "type": "object",
            "description": "Expected results from the legacy analysis",
            "properties": {
              "normal_displacement_cm": {
                "type": "number",
                "minimum": -0.1,
                "description": "Maximum sliding displacement for normal direction in centimeters"
              },
              "inverse_displacement_cm": {
                "type": "number",
                "minimum": -0.1,
                "description": "Maximum sliding displacement for inverse direction in centimeters"
              },
              "kmax": {
                "type": "number",
                "description": "Maximum amplification factor (decoupled/coupled only)"
              },
              "vs_final_mps": {
                "type": "number",
                "minimum": 0,
                "description": "Final shear wave velocity in m/s (decoupled/coupled only)"
              },
              "damping_final": {
                "type": "number",
                "minimum": 0,
                "maximum": 1,
                "description": "Final damping ratio (decoupled/coupled only)"
              }
            },
            "required": [
              "normal_displacement_cm",
              "inverse_displacement_cm"
            ],
            "additionalProperties": false
          }
        },
        "required": [
          "analysis_id",
          "ground_motion_parameters",
          "analysis",
          "site_parameters",
          "results"
        ],
        "additionalProperties": false,
        "allOf": [
          {
            "if": {
              "properties": {
                "analysis": {
                  "properties": {
                    "method": {
                      "enum": [
                        "decoupled",
                        "coupled"
                      ]
                    }
                  },
                  "required": [
                    "method"
                  ]
                }
              }
            },
            "then": {
              "properties": {
                "site_parameters": {
                  "required": [
                    "ky_g",
                    "height_m",
                    "vs_slope_mps",
                    "vs_base_mps",
                    "damping_ratio"
                  ]
                }
              }
            }
          },
          {
            "if": {
              "properties": {
                "analysis": {
                  "properties": {
                    "mode": {
                      "const": "equivalent_linear"
                    }
                  },
                  "required": [
                    "mode"
                  ]
                }
              }
            },
            "then": {
              "properties": {
                "site_parameters": {
                  "allOf": [
                    {
                      "required": [
                        "reference_strain"
                      ]
                    }
                  ]
                }
              }
            }
          }
        ]
      }
    }
  },
  "required": [
    "schema_version",
    "metadata",
    "analyses"
  ],
  "additionalProperties": false
}